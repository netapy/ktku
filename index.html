<!DOCTYPE html>
<html lang="fr">

<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Kataku</title>
  <meta name="description" content="Kataku">
  <meta name="author" content="LFB">
  <link rel="manifest" href="./manifest.json">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="propeller" content="022e5cb60dd89ccffad196bbdbabdcaf">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">

  <!-- JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/alasql/0.6.1/alasql.min.js"></script>
  <script src="js/ktk.js"></script>
  <script src="js/img.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146443684-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-146443684-2');
  </script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="assets/icon.png">
  <link rel="apple-touch-icon" href="assets/icon192.png">
  <link rel="apple-touch-icon" href="touch-icon-iphone.png">
  <link rel="apple-touch-icon" sizes="152x152" href="touch-icon-ipad.png">
  <link rel="apple-touch-icon" sizes="180x180" href="touch-icon-iphone-retina.png">
  <link rel="apple-touch-icon" sizes="167x167" href="touch-icon-ipad-retina.png">
</head>

<body scroll="no" style="overflow: hidden;">

  <div class="installPop">
    <img src="assets/icon2.png"
      style="height: 75%; margin-right: 12px; border-radius: 20%; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
    <span style="font-size: 14px; width: 60%; padding:0px 5px;">Télécharge <span
        style="font-family: GapSansBold;">Kataku</span> en tapant sur "<strong style="white-space: nowrap;">Partager
        <img src="assets/interface/share.png" style="height: 20px; transform: translateY(5px);"></strong>" puis
      "<strong>
        Ajouter à l'écran
        d'accueil</strong>".</span>
  </div>
  <div class="installPop">
    <img src="assets/icon2.png"
      style="height: 75%; margin-right: 12px; border-radius: 20%; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
    <span style="font-size: 14px; width: 60%; padding:0px 5px;">Télécharge <span
        style="font-family: GapSansBold;">Kataku</span> en tapant sur "<strong style="white-space: nowrap;">Menu <img
          src="assets/interface/ch_share.png" style="height: 20px; transform: translateY(5px);"></strong>"
      puis "<strong> Ajouter à l'écran
        d'accueil</strong>".</span>
  </div>

  <!-- Primary Page Layout
  ––––––––––––––––––––––––––––––––––––––––––––––––––-->
  <div class="mainContainer">
    <div class="menu">
      <h5 id='titreMenu' style="margin-top:6%; width: 100%; white-space: nowrap;">On joue ?</h5>
      <div style="width: 100%; height:33%;">
        <img class="brainlet" src="assets/selecjoueurs.png">
      </div>
      <div id="listeJoueurs" class="styleLstJoueurs row" tabindex="0">
        <span id="dumbPrListe"></span>
      </div>
      <div style="width: 100%; position: relative; margin-bottom: 20px;">
        <span class="btnPlus" style="background-color: #F1F1F1; color: #363636;">☰</span>
        <input id="champJoueur" class="champJoueurAjout" placeholder="Joueur..." maxlength="8">
        <span class="btnPlus" style="background-color: #363636; padding-left: 10px;padding-right: 10px;"
          onclick="ajoutUnJoueur(document.getElementById('champJoueur'))">+</span>
      </div>
      <div style='width: 100%; z-index: 10; height: auto;'>
        <button id="suivantPage1" class="button-primary" onclick="GOslider()" style="opacity: 0.6;" disabled>- Ajoute
          3
          joueurs
          -</button>
      </div>
      <div class="logoktk">
        <img class='logobot' src="assets/logo_kataku_transpar.png" />
      </div>
    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>

  <script>
    document.getElementById('champJoueur').addEventListener("keyup", function (event) {
      if (event.key === "Enter") {
        ajoutUnJoueur(this)
      }
    });
    let btnSuivantP1 = document.getElementById("suivantPage1")

    function ajoutUnJoueur(ee) {
      let lstElemdejq = document.getElementsByClassName('jrSelect');
      for (let ii in lstElemdejq) {
        if (String(lstElemdejq[ii].innerHTML).toLowerCase() == String(ee.value).toLowerCase() + " ") {
          return
        }
      }
      if (lstElemdejq.length == 12) {
        alert('Max 8 joueurs')
      } else if (ee.value.replace(" ", "") == "") {
        null;
      } else {
        let htmlTagJr = "<span onclick='this.parentNode.removeChild(this); adjustBtn()' class='jrSelect'>" + ee.value +
          " </span> ";
        document.getElementById('dumbPrListe').insertAdjacentHTML('beforebegin', htmlTagJr);
        adjustBtn();
        ee.value = "";
        ee.focus();
      }
    }

    function adjustBtn() {
      if (document.getElementsByClassName('jrSelect').length >= 3) {
        btnSuivantP1.disabled = false;
        btnSuivantP1.style.opacity = 1;
        btnSuivantP1.innerHTML = '- Suivant -';
      } else {
        btnSuivantP1.innerHTML = "- Ajoute " + String(3 - document.getElementsByClassName('jrSelect').length) +
          " joueurs -";
        btnSuivantP1.disabled = true;
        btnSuivantP1.style.opacity = 0.6;
      }
    }
  </script>

  <script>
    let Lstjoueurs = []

    function GOslider() {
      Lstjoueurs = []
      let spanJoueurs = document.getElementsByClassName('jrSelect')
      for (var i = 0; i < spanJoueurs.length; i++) {
        Lstjoueurs.push(spanJoueurs[i].outerText)
      }
      localStorage.setItem('lesJoueurs', Lstjoueurs)
      document.body.style.transform = "rotateY(-90deg)";
      setTimeout(() => {
        window.location.href = 'slider.html';
      }, 500);
    }
  </script>

  <script>
    var codeActif;
    if (localStorage.getItem('linkCode') == null || assocCode[localStorage.getItem('linkCode')] == undefined) {
      codeActif = assocCode['classique']
    } else {
      codeActif = assocCode[localStorage.getItem('linkCode')]
    }
  </script>

  <script>
    document.getElementById("titreMenu").innerHTML = codeActif['titreMenu'][Math.floor(Math.random() * codeActif[
      'titreMenu'].length)];
    document.getElementsByClassName('brainlet')[0].src = codeActif['imgAcc']
  </script>

  <script>
    function listeJoueurss2(message, action) {
      let tablee = ['i', 'j', 'k', 'l', 'm', "1", 'n', 'o', ")", ".", ",", 'p', 'q', 'r', "<", 's', 't', 'u', 'v', 'w',
        'd', 'e', 'x', 'y', "Q", "R", "S", "T", "U", 'z', "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L",
        "M", "N", "O", "P", "V", 'a', 'b', 'c', 'f', 'g', 'h', "W", "X", "Y", "Z", ";"
      ]
      let text = message;
      let encrypted = "";
      for (var i = 0; i < text.length; i++) {
        let positionUn = tablee.indexOf(text[i]);
        let n = null;
        if (positionUn != "-1") {
          n = action == 'encrypt' ? positionUn + 4 : positionUn - 4;
          if (n >= 58) {
            n = n - 58;
          } else if (n < 0) {
            n = n + 58;
          }
          s = tablee[n];
        } else {
          s = text[i]
        }
        encrypted += s;
      }
      //ne pas oublier de escape les " quand on veut le passer en JSON
      return encrypted;
    }

    fetch('https://kataku.app/dbjsn.txt')
      .then(function (response) {
        return response.text();
      })
      .then(function (data) {
        var jsonrep = JSON.parse(listeJoueurss2(data, 'NJKFFFF'));
        localStorage.setItem("contenu", JSON.stringify(jsonrep))
      })
      .catch(function (err) {
        console.log(err)
      });
  </script>
  <script>
    window.history.pushState("null", "null", "/")
  </script>
  <script>
    try {
      let lstprovjr = localStorage.getItem('lesJoueurs').split(',')
      if (lstprovjr.length >= 3) {
        for (i in lstprovjr) {
          let htmlTagJr = "<span onclick='this.parentNode.removeChild(this); adjustBtn()' class='jrSelect'>" +
            lstprovjr[
              i] +
            " </span> ";
          document.getElementById('dumbPrListe').insertAdjacentHTML('beforebegin', htmlTagJr);
          adjustBtn();
        }
      }
    } catch (e) {
      console.log(e)
    }
  </script>

  <script>
    let ua = navigator.userAgent.toLowerCase();
    if (window.matchMedia('(display-mode: standalone)').matches == false) {
      if (window.innerHeight > window.innerWidth) {
        document.body.scroll = 'yes';
        document.body.style.overflow = '';
        if (ua.indexOf('iphone') != -1 || ua.indexOf('ipad') != -1) {
          document.getElementsByClassName('installPop')[0].style.display = "flex";
        } else {
          document.getElementsByClassName('installPop')[1].style.display = "flex";
        }
      }
    }
  </script>
  <!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>

</html>
